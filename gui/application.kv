<AppLayout>:
    Label:
        text: "Bill Analyzer"
        pos_hint: {"x": 0, "top": 1}
        size_hint: 1, 0.05

    TextInput:
        id: file_input
        multiline: False
        pos_hint: {"x": 0, "top": 0.95}
        size_hint: 0.8, 0.05
        text_size: self.size

    Button:
        text: "Browse file"
        pos_hint: {"x": 0.8, "top": 0.95}
        size_hint: 0.2, 0.05
        on_release: root.selectFile()

    ActionButtonsWidget:
        id: actionButtons
        pos_hint: {"x": 0, "top": 0.9}
        size_hint: 1, 0.1
    
    ProductListWidget:
        id: productList
        pos_hint: {"x": 0, "top": 0.8}
        size_hint: 1, 0.7

    Label:
        text: "Total sum: {0:.2f}".format(root.ids.productList.getTotalSum())
        pos_hint: {"x": 0, "top": 0.1}
        size_hint: 1, 0.05

    Label:
        text: "Expected sum:"
        pos_hint: {"x": 0, "top": 0.05}
        size_hint: 1, 0.05

<ActionButtonsWidget>:
    Button:
        id: button_generate
        pos_hint: {"x": 0, "top": 1}
        size_hint: 0.25, 1
        text: "Generate"

    Button:
        id: button_clear
        pos_hint: {"x": 0.25, "top": 1}
        size_hint: 0.25, 1
        text: "Clear list"

    Button:
        id: button_options
        pos_hint: {"x": 0.5, "top": 1}
        size_hint: 0.25, 1
        text: "Options"

    Button:
        id: button_results
        pos_hint: {"x": 0.75, "top": 1}
        size_hint: 0.25, 1
        text: "Results"

<ProductListWidget>:
    layout: layout 

    ScrollView:
        pos_hint: {"x": 0, "top": 1}
        size_hint: 1, None
        size: root.width, root.height

        do_scroll_x: False
        do_scroll_y: True

        GridLayout:
            id: layout 
            cols: 1
            size_hint_y: None
            row_default_height: root.height * 0.1
            height: self.minimum_height

            GridLayout:
                cols: 3

                Label:
                    text: "Product Name"

                Label:
                    text: "Product Price"

                Label:
                    text: "Persons"

<ProductEntryWidget>:
    cols: 3

    Label:
        id: product_name
        text: "Product"

    TextInput:
        id: product_price
        multiline: False

    PersonSelectionWidget:
        id: selection_widget
    

<PersonSelectionWidget>:
    rows: 1

<LoadDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserIconView:
            id: filechooser

        BoxLayout:
            size_hint_y: None
            height: 30
            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Load"
                on_release: root.load(filechooser.path, filechooser.selection)

<PersonSelector>:
    Button:
        pos_hint: {"x": 0, "top": 1}
        size_hint: 1, 1

    Label:
        id: selectorText
        pos_hint: {"x": 0, "top": 1}
        size_hint: 1, 0.5

    PercentageProgress:
        id: progress
        pos_hint: {"x": 0, "top": 0.5}
        size_hint: 1, 0.5

<PercentageProgress>:
    max: 100
    value: 0
 
    canvas:
        Color:
            rgba: 0.2, 0.2, 0.2, 1 

        Rectangle:
            pos: self.x + dp(5), self.y + dp(5)
            size: self.width - dp(10), self.height - dp(10)

        Color:
            rgba: 0.8, 0.1, 0.5, 1

        Rectangle:
            pos: self.x + dp(5), self.y + dp(5)
            size: self.width * (self.value / float(self.max)) if self.max else dp(5), self.height - dp(10)
    
    Label:
        pos_hint: {"x": 0, "top": 1}
        size_hint: 1, 1
        text: "{0:.0f}%".format(root.value)